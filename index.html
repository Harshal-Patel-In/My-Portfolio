<!DOCTYPE html>
<html lang="en" class="antialiased">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portfolio OS 11</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        'win-dark': '#202020',
                        'win-panel': 'rgba(255, 255, 255, 0.85)',
                        'win-panel-dark': 'rgba(32, 32, 32, 0.85)',
                        'win-blue': '#0078d4',
                    },
                    animation: {
                        'blink': 'blink 1s step-end infinite',
                    },
                    keyframes: {
                        blink: {
                            '50%': { opacity: '0' },
                        }
                    }
                }
            }
        }
    </script>
    <style>
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: rgba(156, 163, 175, 0.5); border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: rgba(156, 163, 175, 0.8); }
        
        .glass {
            backdrop-filter: blur(20px) saturate(120%);
            -webkit-backdrop-filter: blur(20px) saturate(120%);
        }
        
        /* Desktop Icons - Improved Contrast */
        .desktop-icon:hover { background-color: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255,255,255,0.1); }
        .desktop-icon.selected { background-color: rgba(255, 255, 255, 0.2); border: 1px solid rgba(255,255,255,0.3); }
        
        /* Stronger text shadow for readability on any background */
        .icon-label {
            text-shadow: 0 1px 3px rgba(0,0,0,0.9);
        }
        
        /* Wallpapers */
        .bg-bloom { background-image: url('https://images.unsplash.com/photo-1618005182384-a83a8bd57fbe?q=80&w=2564&auto=format&fit=crop'); }
        .bg-mountain { background-image: url('https://images.unsplash.com/photo-1464822759023-fed622ff2c3b?q=80&w=2670&auto=format&fit=crop'); }
        .bg-abstract { background-image: url('https://images.unsplash.com/photo-1550684848-fac1c5b4e853?q=80&w=2670&auto=format&fit=crop'); }
        /* New High Contrast Options */
        .bg-space { background-image: url('https://images.unsplash.com/photo-1451187580459-43490279c0fa?q=80&w=2672&auto=format&fit=crop'); }
        /* Fixed Broken Link -> New Midnight Gradient */
        .bg-midnight { background-image: url('https://images.unsplash.com/photo-1475274047050-1d0c0975c63e?q=80&w=2672&auto=format&fit=crop'); }
        
        .bg-lock { background-image: url('https://images.unsplash.com/photo-1506744038136-46273834b3fb?q=80&w=2670&auto=format&fit=crop'); }
        
        /* Animations */
        .pop-in { animation: popIn 0.25s cubic-bezier(0.2, 0.8, 0.2, 1); }
        @keyframes popIn { from { transform: scale(0.95) translateY(10px); opacity: 0; } to { transform: scale(1) translateY(0); opacity: 1; } }
        
        .slide-up { animation: slideUp 0.3s cubic-bezier(0.2, 0.8, 0.2, 1); }
        @keyframes slideUp { from { transform: translateY(100%) translateX(-50%); opacity: 0; } to { transform: translateY(0) translateX(-50%); opacity: 1; } }

        /* Startup Sequence */
        #bios-screen { z-index: 10002; }
        #boot-screen { z-index: 10001; }
        #lock-screen { z-index: 10000; transition: transform 0.6s cubic-bezier(0.2, 0.8, 0.2, 1), opacity 0.6s ease; }
        #login-screen { z-index: 9999; transition: opacity 0.5s ease; }
        
        .fade-out { opacity: 0; pointer-events: none; transition: opacity 0.8s ease; }
        .slide-up-out { transform: translateY(-100%); opacity: 0; }
        
        /* App Specific */
        .project-card:hover { transform: translateY(-2px); }
        .skill-badge:hover { transform: scale(1.05); }
        
        /* Terminal */
        .terminal-text { font-family: 'Courier New', Courier, monospace; }
        
        /* Initial State Hiding - CRITICAL FOR FIXING FLICKER */
        .startup-hidden { opacity: 0; pointer-events: none; transition: opacity 1.5s ease; }
    </style>
</head>
<!-- Changed default to bg-space for best visibility -->
<body class="bg-space bg-cover bg-center bg-no-repeat h-screen w-screen overflow-hidden select-none text-gray-800 dark:text-white transition-all duration-500 font-sans" id="desktop-body">

    <!-- 1. BIOS Screen -->
    <div id="bios-screen" class="fixed inset-0 bg-black font-mono text-gray-300 p-8 text-sm flex flex-col justify-start">
        <div id="bios-text"></div>
        <div class="mt-2"><span class="animate-blink">_</span></div>
    </div>

    <!-- 2. Boot Screen (Windows Logo) -->
    <div id="boot-screen" class="fixed inset-0 bg-black flex flex-col items-center justify-center text-white hidden">
        <i class="fab fa-windows text-blue-500 text-8xl mb-16 animate-pulse"></i>
        <div class="w-10 h-10 border-4 border-white border-t-transparent rounded-full animate-spin"></div>
    </div>

    <!-- 3. Lock Screen -->
    <div id="lock-screen" class="fixed inset-0 bg-lock bg-cover bg-center flex flex-col items-center justify-between py-16 text-white hidden" onclick="unlockScreen()">
        <div class="flex flex-col items-center mt-16 animate-fade-in-down">
            <div id="lock-time" class="text-8xl font-bold drop-shadow-lg font-sans tracking-tight">12:00</div>
            <div id="lock-date" class="text-2xl font-medium drop-shadow-md mt-2">Monday, November 24</div>
        </div>
        <div class="flex flex-col items-center gap-2 animate-bounce">
            <div class="text-sm font-medium drop-shadow">Click to unlock</div>
            <i class="fas fa-chevron-up"></i>
        </div>
    </div>

    <!-- 4. Login Screen -->
    <div id="login-screen" class="fixed inset-0 bg-cover bg-center flex flex-col items-center justify-center text-white hidden backdrop-blur-3xl bg-black/40">
        <div class="flex flex-col items-center animate-fade-in-up">
            <img src="https://ui-avatars.com/api/?name=Harshal+Patel&background=0078d4&color=fff&size=128" class="w-32 h-32 rounded-full shadow-2xl mb-6 border-4 border-white/20">
            <div class="text-3xl font-semibold mb-2">Harshal Patel</div>
            <div class="text-gray-300 mb-8">Administrator</div>
            
            <button onclick="loginUser()" id="login-btn" class="bg-white/20 hover:bg-white/30 backdrop-blur-md border border-white/30 px-8 py-2 rounded-md font-medium transition active:scale-95 flex items-center gap-2">
                Sign In
            </button>
            <div id="login-spinner" class="hidden">
                 <div class="w-6 h-6 border-2 border-white border-t-transparent rounded-full animate-spin"></div>
            </div>
        </div>
        
        <div class="absolute bottom-8 right-8 flex gap-4 text-2xl">
            <i class="fas fa-wifi cursor-pointer hover:text-gray-300"></i>
            <i class="fas fa-universal-access cursor-pointer hover:text-gray-300"></i>
            <i class="fas fa-power-off cursor-pointer hover:text-gray-300"></i>
        </div>
    </div>

    <!-- Custom Modal (Popup) -->
    <div id="custom-modal" class="hidden fixed inset-0 z-[99999] flex items-center justify-center bg-black/50 backdrop-blur-sm">
        <div class="bg-white dark:bg-[#2b2b2b] p-6 rounded-lg shadow-2xl w-80 transform transition-all scale-100 text-center border border-gray-200 dark:border-gray-700">
            <h3 class="text-lg font-bold mb-2 dark:text-white">System Message</h3>
            <p class="text-gray-600 dark:text-gray-300 mb-6" id="modal-message">Hello World!</p>
            <button onclick="document.getElementById('custom-modal').classList.add('hidden')" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 w-full">OK</button>
        </div>
    </div>

    <!-- Desktop Icons (Initially Hidden to prevent Flicker) -->
    <div class="absolute top-0 left-0 h-[calc(100%-48px)] w-full p-2 grid grid-flow-col grid-rows-6 gap-2 auto-cols-min content-start startup-hidden" id="desktop-icons">
        <!-- Injected via JS -->
    </div>

    <!-- Context Menu -->
    <div id="context-menu" class="hidden fixed w-48 bg-win-panel dark:bg-[#2b2b2b] glass border border-gray-200 dark:border-gray-700 rounded-md shadow-xl z-50 py-1 text-sm text-gray-800 dark:text-white">
        <div class="px-4 py-1.5 hover:bg-white/50 dark:hover:bg-white/10 cursor-pointer flex items-center gap-2" onclick="location.reload()">
            <i class="fas fa-rotate-right w-4"></i> Restart System
        </div>
        <div class="h-px bg-gray-300 dark:bg-gray-600 my-1 mx-2"></div>
        <div class="px-4 py-1.5 hover:bg-white/50 dark:hover:bg-white/10 cursor-pointer flex items-center gap-2" onclick="setWallpaper('bg-bloom'); setWallpaper('bg-space'); /* Cycle mock */ ">
            <i class="fas fa-image w-4"></i> Next Wallpaper
        </div>
        <div class="px-4 py-1.5 hover:bg-white/50 dark:hover:bg-white/10 cursor-pointer flex items-center gap-2" onclick="toggleDarkMode()">
            <i class="fas fa-moon w-4"></i> Toggle Dark Mode
        </div>
        <div class="h-px bg-gray-300 dark:bg-gray-600 my-1 mx-2"></div>
        <div class="px-4 py-1.5 hover:bg-white/50 dark:hover:bg-white/10 cursor-pointer flex items-center gap-2" onclick="openApp('settings')">
            <i class="fas fa-sliders w-4"></i> Personalize
        </div>
        <div class="px-4 py-1.5 hover:bg-white/50 dark:hover:bg-white/10 cursor-pointer flex items-center gap-2" onclick="openApp('terminal')">
            <i class="fas fa-terminal w-4"></i> Open Terminal
        </div>
    </div>

    <!-- Window Container -->
    <div id="window-area" class="absolute inset-0 pointer-events-none z-10 overflow-hidden">
        <!-- Windows injected here -->
    </div>

    <!-- Start Menu -->
    <div id="start-menu" class="hidden absolute bottom-14 left-1/2 w-[640px] h-[680px] bg-win-panel dark:bg-win-panel-dark glass rounded-xl shadow-2xl z-50 p-6 flex flex-col transition-colors duration-300 border border-white/40 dark:border-gray-600/50 transform -translate-x-1/2 origin-bottom">
        <div class="mb-6 relative">
            <i class="fas fa-search absolute left-4 top-3 text-gray-500"></i>
            <input type="text" placeholder="Search for apps, settings, and documents" class="w-full bg-white/60 dark:bg-black/40 rounded-full py-2.5 pl-12 pr-4 border border-gray-300 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500/50 shadow-sm placeholder-gray-500">
        </div>
        
        <div class="flex-1 overflow-y-auto pr-2 custom-scrollbar">
            <div class="flex justify-between items-center mb-4 px-2">
                <h3 class="text-sm font-semibold text-gray-700 dark:text-gray-200">Pinned</h3>
                <button class="text-xs bg-white/50 dark:bg-white/10 px-3 py-1 rounded-md hover:bg-white/80 dark:hover:bg-white/20 transition">All apps <i class="fas fa-chevron-right ml-1 text-[10px]"></i></button>
            </div>
            <div class="grid grid-cols-6 gap-2 mb-8" id="start-menu-grid">
                <!-- Icons injected JS -->
            </div>
            
            <h3 class="text-sm font-semibold mb-4 px-2 text-gray-700 dark:text-gray-200">Recommended</h3>
            <div class="grid grid-cols-2 gap-2">
                <div class="flex items-center p-3 hover:bg-white/50 dark:hover:bg-white/10 rounded-lg cursor-pointer transition group" onclick="openApp('about')">
                    <div class="w-10 h-10 bg-blue-100 dark:bg-blue-900/30 rounded-full flex items-center justify-center mr-3 text-blue-600 dark:text-blue-400">
                         <i class="fas fa-user text-lg"></i>
                    </div>
                    <div>
                        <div class="text-sm font-medium">Profile Overview</div>
                        <div class="text-xs text-gray-500">Recently viewed</div>
                    </div>
                </div>
                 <div class="flex items-center p-3 hover:bg-white/50 dark:hover:bg-white/10 rounded-lg cursor-pointer transition group" onclick="openApp('projects')">
                    <div class="w-10 h-10 bg-orange-100 dark:bg-orange-900/30 rounded-full flex items-center justify-center mr-3 text-orange-600 dark:text-orange-400">
                         <i class="fas fa-rocket text-lg"></i>
                    </div>
                    <div>
                        <div class="text-sm font-medium">Latest Projects</div>
                        <div class="text-xs text-gray-500">Updated yesterday</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="mt-auto pt-4 border-t border-gray-300/30 dark:border-gray-600/30 flex justify-between items-center px-2">
            <div class="flex items-center gap-3 hover:bg-white/40 dark:hover:bg-white/10 p-2 rounded-lg cursor-pointer transition">
                <img src="https://ui-avatars.com/api/?name=Harshal+Patel&background=0078d4&color=fff" class="w-8 h-8 rounded-full shadow-sm">
                <span class="text-sm font-medium text-gray-800 dark:text-gray-200">Harshal Patel</span>
            </div>
            <i class="fas fa-power-off text-gray-600 dark:text-gray-300 hover:bg-red-100 dark:hover:bg-red-900/30 hover:text-red-500 p-3 rounded-full transition cursor-pointer" title="Shut Down" onclick="location.reload()"></i>
        </div>
    </div>

    <!-- Calendar/Notification Center -->
    <div id="calendar-flyout" class="hidden absolute bottom-14 right-2 w-80 bg-win-panel dark:bg-win-panel-dark glass rounded-xl shadow-2xl z-50 p-4 slide-up border border-white/40 dark:border-gray-600/50">
        <div class="mb-4">
            <div class="text-sm text-gray-500 font-medium" id="cal-current-date">Monday, November 24</div>
            <div class="flex justify-between items-center mt-2">
                <span class="font-bold text-lg dark:text-white">November 2025</span>
                <div class="flex gap-2 text-gray-600 dark:text-gray-400">
                    <i class="fas fa-chevron-up p-1 hover:bg-gray-200 dark:hover:bg-gray-700 rounded cursor-pointer"></i>
                    <i class="fas fa-chevron-down p-1 hover:bg-gray-200 dark:hover:bg-gray-700 rounded cursor-pointer"></i>
                </div>
            </div>
        </div>
        <div class="grid grid-cols-7 gap-1 text-center text-xs text-gray-600 dark:text-gray-400 mb-2 font-medium">
            <span>Su</span><span>Mo</span><span>Tu</span><span>We</span><span>Th</span><span>Fr</span><span>Sa</span>
        </div>
        <div class="grid grid-cols-7 gap-1 text-center text-sm" id="calendar-grid">
             <!-- JS generates days -->
        </div>
        <div class="mt-4 border-t border-gray-300 dark:border-gray-600 pt-4">
            <div class="text-xs font-bold text-gray-500 uppercase tracking-wide mb-2">Notifications</div>
            <div class="flex gap-3 p-2 hover:bg-white/50 dark:hover:bg-white/10 rounded cursor-pointer">
                <div class="w-8 h-8 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center flex-shrink-0"><i class="fas fa-envelope"></i></div>
                <div>
                    <div class="text-sm font-bold dark:text-white">New Message</div>
                    <div class="text-xs text-gray-500">Recruiter: "Are you available for..."</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Taskbar (Initially Hidden to prevent Flicker) -->
    <div id="taskbar" class="absolute bottom-0 w-full h-12 bg-win-panel dark:bg-win-panel-dark glass border-t border-white/20 dark:border-white/5 flex justify-between items-center px-2 z-50 transition-colors duration-300 backdrop-blur-2xl startup-hidden">
        <!-- Widgets (Left) -->
        <div class="flex items-center gap-1 w-40 hidden md:flex pl-2">
             <div class="hover:bg-white/30 dark:hover:bg-white/10 p-2 rounded-md transition cursor-pointer flex items-center gap-2 group">
                <i class="fas fa-cloud-sun text-blue-500 group-hover:text-blue-600 transition"></i> 
                <div class="flex flex-col leading-none">
                    <span class="text-xs font-medium">72Â°F</span>
                    <span class="text-[10px] text-gray-500 dark:text-gray-400">Sunny</span>
                </div>
            </div>
        </div>

        <!-- Center Apps -->
        <div class="flex items-center gap-1 h-full px-2" id="taskbar-apps">
            <div class="h-[40px] w-[40px] flex items-center justify-center hover:bg-white/40 dark:hover:bg-white/10 rounded-md active:scale-95 transition cursor-pointer" onclick="toggleStartMenu()">
                <i class="fab fa-windows text-blue-500 text-2xl drop-shadow-sm hover:text-blue-400 transition"></i>
            </div>
            <!-- App Icons injected here -->
        </div>

        <!-- System Tray (Right) -->
        <div class="flex items-center gap-2 h-full px-2">
            <div class="flex items-center gap-3 hover:bg-white/30 dark:hover:bg-white/10 p-2 rounded-md h-[85%] transition cursor-pointer text-xs text-gray-700 dark:text-gray-300">
                <i class="fas fa-wifi"></i>
                <i class="fas fa-volume-up"></i>
                <i class="fas fa-battery-full"></i>
            </div>
            <div class="flex flex-col items-end justify-center hover:bg-white/30 dark:hover:bg-white/10 px-2 rounded-md h-[85%] transition cursor-pointer min-w-[80px]" onclick="toggleCalendar()">
                <span id="clock-time" class="text-xs font-medium leading-none mb-[3px]">12:00 PM</span>
                <span id="clock-date" class="text-[10px] leading-none text-gray-600 dark:text-gray-400">11/24/2025</span>
            </div>
        </div>
    </div>

    <script>
        // --- CONFIG & STATE ---
        const APPS = [
            { id: 'about', name: 'About Me', icon: 'fa-solid fa-user-astronaut', color: 'text-purple-500', bg: 'bg-purple-100' },
            { id: 'stack', name: 'Tech Stack', icon: 'fa-solid fa-layer-group', color: 'text-yellow-500', bg: 'bg-yellow-100' },
            { id: 'projects', name: 'Projects', icon: 'fa-solid fa-rocket', color: 'text-blue-500', bg: 'bg-blue-100' },
            { id: 'terminal', name: 'Terminal', icon: 'fas fa-terminal', color: 'text-green-400', bg: 'bg-gray-900' },
            { id: 'calc', name: 'Calculator', icon: 'fa-solid fa-calculator', color: 'text-green-600', bg: 'bg-green-100' },
            { id: 'contact', name: 'Contact', icon: 'fa-solid fa-envelope', color: 'text-red-500', bg: 'bg-red-100' },
            { id: 'github', name: 'GitHub', icon: 'fa-brands fa-github', color: 'text-white', bg: 'bg-black' },
            { id: 'browser', name: 'Edge', icon: 'fa-brands fa-edge', color: 'text-blue-400', bg: 'bg-blue-50' },
            { id: 'settings', name: 'Settings', icon: 'fa-solid fa-gear', color: 'text-gray-500', bg: 'bg-gray-100' },
        ];

        let windows = [];
        let highestZ = 100;
        let isDarkMode = false;

        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
             runBiosSequence();
             
             setInterval(updateClock, 1000);
             updateClock();
             renderDesktopIcons();
             renderTaskbarIcons();
             renderStartMenuIcons();
             renderCalendar();
             
             document.addEventListener('click', (e) => {
                const startMenu = document.getElementById('start-menu');
                const calendar = document.getElementById('calendar-flyout');
                const taskbar = document.getElementById('taskbar');
                const ctxMenu = document.getElementById('context-menu');
                
                if (!startMenu.contains(e.target) && !taskbar.contains(e.target)) startMenu.classList.add('hidden');
                if (!calendar.contains(e.target) && !taskbar.contains(e.target)) calendar.classList.add('hidden');
                ctxMenu.classList.add('hidden');
            });

            document.addEventListener('contextmenu', (e) => {
                e.preventDefault();
                const ctxMenu = document.getElementById('context-menu');
                ctxMenu.style.top = `${e.clientY}px`;
                ctxMenu.style.left = `${e.clientX}px`;
                ctxMenu.classList.remove('hidden');
            });
        });

        // --- STARTUP LOGIC ---

        function runBiosSequence() {
            const biosScreen = document.getElementById('bios-screen');
            const biosText = document.getElementById('bios-text');
            const bootScreen = document.getElementById('boot-screen');
            const lockScreen = document.getElementById('lock-screen');
            
            const lines = [
                "EFI Shell version 2.40 [5.12]",
                "Current running mode 1.1.2",
                "Device mapping table",
                "  fs0  : HardDisk - Alias hd16b0b fs0",
                "  blk0 : BlockDevice - Alias (null)",
                " ",
                "Press ESC in 1 seconds to skip startup.nsh, any other key to continue",
                "Shell> _"
            ];

            let delay = 0;
            lines.forEach((line, i) => {
                setTimeout(() => {
                    biosText.innerHTML += line + "<br>";
                }, delay);
                delay += (Math.random() * 200) + 100;
            });

            setTimeout(() => {
                biosScreen.classList.add('hidden');
                bootScreen.classList.remove('hidden');
            }, delay + 1000);

            setTimeout(() => {
                // Fix: Reveal lock screen underneath FIRST
                lockScreen.classList.remove('hidden');
                updateLockScreenClock();
                // THEN fade out boot screen to reveal it
                bootScreen.classList.add('fade-out');
                setTimeout(() => {
                    bootScreen.classList.add('hidden');
                }, 800);
            }, delay + 3500);
        }

        function updateLockScreenClock() {
            const now = new Date();
            document.getElementById('lock-time').innerText = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', hour12: false });
            document.getElementById('lock-date').innerText = now.toLocaleDateString(undefined, { weekday: 'long', month: 'long', day: 'numeric' });
        }
        
        function unlockScreen() {
            const lockScreen = document.getElementById('lock-screen');
            const loginScreen = document.getElementById('login-screen');
            lockScreen.classList.add('slide-up-out');
            setTimeout(() => {
                lockScreen.classList.add('hidden');
                loginScreen.classList.remove('hidden');
            }, 500);
        }
        
        function loginUser() {
            const btn = document.getElementById('login-btn');
            const spinner = document.getElementById('login-spinner');
            const loginScreen = document.getElementById('login-screen');
            
            btn.classList.add('hidden');
            spinner.classList.remove('hidden');
            
            setTimeout(() => {
                loginScreen.classList.add('fade-out');
                setTimeout(() => {
                    loginScreen.classList.add('hidden');
                    // Reveal Desktop UI seamlessly
                    document.getElementById('desktop-icons').classList.remove('startup-hidden');
                    document.getElementById('taskbar').classList.remove('startup-hidden');
                    openApp('about'); 
                }, 600);
            }, 1500);
        }

        // --- SYSTEM FUNCTIONS ---

        function updateClock() {
            const now = new Date();
            document.getElementById('clock-time').innerText = now.toLocaleTimeString([], { hour: 'numeric', minute: '2-digit' });
            document.getElementById('clock-date').innerText = now.toLocaleDateString();
            document.getElementById('cal-current-date').innerText = now.toLocaleDateString(undefined, { weekday: 'long', month: 'long', day: 'numeric' });
        }
        
        function renderCalendar() {
            const grid = document.getElementById('calendar-grid');
            let html = '';
            for(let i=28; i<=30; i++) html += `<span class="text-gray-400 p-2">${i}</span>`;
            for(let i=1; i<=31; i++) {
                const todayClass = i === new Date().getDate() ? 'bg-blue-600 text-white font-bold rounded-full' : 'hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full dark:text-gray-200';
                html += `<span class="p-2 cursor-default ${todayClass} flex items-center justify-center w-8 h-8 mx-auto text-sm">${i}</span>`;
            }
            grid.innerHTML = html;
        }

        function toggleStartMenu() {
            const menu = document.getElementById('start-menu');
            document.getElementById('calendar-flyout').classList.add('hidden');
            menu.classList.toggle('hidden');
            if(!menu.classList.contains('hidden')) {
                menu.classList.remove('slide-up');
                void menu.offsetWidth; 
                menu.classList.add('slide-up');
            }
        }

        function toggleCalendar() {
            const cal = document.getElementById('calendar-flyout');
            document.getElementById('start-menu').classList.add('hidden');
            cal.classList.toggle('hidden');
            if(!cal.classList.contains('hidden')) {
                cal.classList.remove('slide-up');
                void cal.offsetWidth; 
                cal.classList.add('slide-up');
            }
        }

        function toggleDarkMode() {
            isDarkMode = !isDarkMode;
            document.documentElement.classList.toggle('dark');
            const btn = document.getElementById('dm-toggle-btn');
            if(btn) btn.innerText = isDarkMode ? 'Disable Dark Mode' : 'Enable Dark Mode';
        }

        function setWallpaper(type) {
            const body = document.getElementById('desktop-body');
            // Remove all known wallpaper classes
            body.classList.remove('bg-bloom', 'bg-mountain', 'bg-abstract', 'bg-space', 'bg-midnight');
            // Add the new one
            body.classList.add(type);
        }

        function renderDesktopIcons() {
            const container = document.getElementById('desktop-icons');
            APPS.forEach(app => {
                const el = document.createElement('div');
                el.className = 'desktop-icon w-24 h-24 flex flex-col items-center justify-start pt-4 gap-2 rounded-lg cursor-pointer transition text-shadow group';
                el.innerHTML = `
                    <div class="w-12 h-12 flex items-center justify-center transition transform group-hover:scale-110 duration-200">
                         <i class="${app.icon} text-4xl ${app.color} filter drop-shadow-lg"></i>
                    </div>
                    <span class="text-[11px] text-white text-center leading-tight icon-label px-1 break-words font-medium">${app.name}</span>
                `;
                el.ondblclick = () => openApp(app.id);
                container.appendChild(el);
            });
        }

        function renderTaskbarIcons() {
            const container = document.getElementById('taskbar-apps');
            APPS.forEach(app => {
                const el = document.createElement('div');
                el.id = `taskbar-${app.id}`;
                el.className = 'relative h-[40px] w-[40px] flex items-center justify-center hover:bg-white/40 dark:hover:bg-white/10 rounded-md active:scale-90 transition-all duration-200 cursor-pointer group mx-0.5';
                el.innerHTML = `
                    <i class="${app.icon} text-xl ${app.color} drop-shadow-sm transform group-hover:-translate-y-1 transition duration-200"></i>
                    <div class="absolute -bottom-1 w-1 h-1 bg-gray-400 rounded-full transition-all duration-300 opacity-0 group-hover:w-3" id="indicator-${app.id}"></div>
                `;
                el.onclick = () => handleTaskbarClick(app.id);
                const tip = document.createElement('div');
                tip.className = 'absolute bottom-14 bg-gray-800/90 backdrop-blur text-white text-xs px-3 py-1.5 rounded shadow-lg opacity-0 group-hover:opacity-100 transition pointer-events-none whitespace-nowrap border border-gray-700 z-[60] -translate-y-2 group-hover:translate-y-0 duration-200';
                tip.innerText = app.name;
                el.appendChild(tip);
                container.appendChild(el);
            });
        }

        function renderStartMenuIcons() {
            const container = document.getElementById('start-menu-grid');
            APPS.forEach(app => {
                const el = document.createElement('div');
                el.className = 'flex flex-col items-center gap-2 p-2 hover:bg-white/60 dark:hover:bg-white/10 rounded-lg cursor-pointer transition active:scale-95';
                el.innerHTML = `
                    <div class="w-10 h-10 flex items-center justify-center bg-white dark:bg-gray-700/50 rounded-lg shadow-sm">
                        <i class="${app.icon} text-xl ${app.color}"></i>
                    </div>
                    <span class="text-[10px] font-medium text-center leading-tight text-gray-700 dark:text-gray-200">${app.name}</span>
                `;
                el.onclick = () => {
                    openApp(app.id);
                    toggleStartMenu();
                };
                container.appendChild(el);
            });
        }

        function openApp(appId) {
            const existing = windows.find(w => w.id === appId);
            if (existing) {
                if (existing.minimized) restoreWindow(appId);
                else bringToFront(appId);
                return;
            }

            const appConfig = APPS.find(a => a.id === appId);
            highestZ++;

            const winEl = document.createElement('div');
            winEl.id = `win-${appId}`;
            winEl.className = `window absolute flex flex-col pop-in pointer-events-auto overflow-hidden shadow-2xl rounded-xl border border-gray-200/50 dark:border-gray-700/50 bg-white/95 dark:bg-[#202020]/95 backdrop-blur-xl`;
            winEl.style.zIndex = highestZ;
            winEl.style.width = '900px';
            winEl.style.height = '600px';
            winEl.style.top = (60 + windows.length * 30) + 'px';
            winEl.style.left = (100 + windows.length * 30) + 'px';

            const contentHtml = getAppContent(appId);

            winEl.innerHTML = `
                <div class="h-10 bg-transparent flex justify-between items-center px-4 select-none border-b border-gray-200/50 dark:border-gray-700/50" onmousedown="startDrag(event, '${appId}')" ondblclick="maximizeWindow('${appId}')">
                    <div class="flex items-center gap-3 text-sm flex-1 h-full text-gray-700 dark:text-gray-200">
                        <i class="${appConfig.icon} ${appConfig.color}"></i>
                        <span class="font-medium ml-1 tracking-wide">${appConfig.name}</span>
                    </div>
                    <div class="flex items-center gap-2 h-full">
                        <div class="p-1.5 hover:bg-gray-200 dark:hover:bg-white/10 rounded transition cursor-pointer" onclick="minimizeWindow('${appId}')"><i class="fas fa-minus text-[10px]"></i></div>
                        <div class="p-1.5 hover:bg-gray-200 dark:hover:bg-white/10 rounded transition cursor-pointer" onclick="maximizeWindow('${appId}')"><i class="far fa-square text-[10px]"></i></div>
                        <div class="p-1.5 hover:bg-red-500 hover:text-white rounded transition cursor-pointer" onclick="closeWindow('${appId}')"><i class="fas fa-times text-sm"></i></div>
                    </div>
                </div>
                <div class="flex-1 relative overflow-hidden flex flex-col bg-gray-50/50 dark:bg-[#151515]/50" onmousedown="bringToFront('${appId}')">
                    ${contentHtml}
                </div>
                <div class="absolute bottom-0 right-0 w-5 h-5 cursor-se-resize z-20 bg-transparent" onmousedown="startResize(event, '${appId}')"></div>
            `;

            document.getElementById('window-area').appendChild(winEl);
            
            windows.push({ id: appId, el: winEl, minimized: false, maximized: false, prevStyles: {} });
            updateTaskbarIndicator(appId, true);
        }

        function closeWindow(id) {
            const win = windows.find(w => w.id === id);
            if (win) {
                win.el.style.transform = 'scale(0.9)';
                win.el.style.opacity = '0';
                setTimeout(() => {
                    win.el.remove();
                    windows = windows.filter(w => w.id !== id);
                    updateTaskbarIndicator(id, false);
                }, 150);
            }
        }

        function minimizeWindow(id) {
            const win = windows.find(w => w.id === id);
            if (win) {
                win.el.style.transform = 'translateY(100px) scale(0.8)';
                win.el.style.opacity = '0';
                setTimeout(() => {
                    win.el.classList.add('hidden');
                    win.minimized = true;
                    updateTaskbarIndicator(id, true, true);
                }, 200);
            }
        }

        function restoreWindow(id) {
            const win = windows.find(w => w.id === id);
            if (win) {
                win.el.classList.remove('hidden');
                void win.el.offsetWidth;
                win.el.style.transform = 'translateY(0) scale(1)';
                win.el.style.opacity = '1';
                win.minimized = false;
                bringToFront(id);
                updateTaskbarIndicator(id, true, false);
            }
        }

        function maximizeWindow(id) {
            const win = windows.find(w => w.id === id);
            if (!win) return;
            if (!win.maximized) {
                win.prevStyles = { top: win.el.style.top, left: win.el.style.left, width: win.el.style.width, height: win.el.style.height, transform: win.el.style.transform, borderRadius: win.el.style.borderRadius };
                win.el.style.transition = 'all 0.2s ease-in-out';
                win.el.style.top = '0'; win.el.style.left = '0'; win.el.style.width = '100%'; win.el.style.height = 'calc(100% - 48px)'; win.el.style.borderRadius = '0'; win.el.style.transform = 'none';
                win.maximized = true;
                setTimeout(() => win.el.style.transition = '', 200);
            } else {
                win.el.style.transition = 'all 0.2s ease-in-out';
                win.el.style.top = win.prevStyles.top; win.el.style.left = win.prevStyles.left; win.el.style.width = win.prevStyles.width; win.el.style.height = win.prevStyles.height; win.el.style.borderRadius = win.prevStyles.borderRadius;
                win.maximized = false;
                setTimeout(() => win.el.style.transition = '', 200);
            }
        }

        function bringToFront(id) {
            const win = windows.find(w => w.id === id);
            if (win) {
                highestZ++;
                win.el.style.zIndex = highestZ;
            }
        }

        function handleTaskbarClick(id) {
            const win = windows.find(w => w.id === id);
            if (!win) openApp(id);
            else if (win.minimized) restoreWindow(id);
            else if (win.el.style.zIndex == highestZ) minimizeWindow(id);
            else bringToFront(id);
        }

        function updateTaskbarIndicator(id, isOpen, isMinimized = false) {
            const indicator = document.getElementById(`indicator-${id}`);
            if (isOpen) {
                indicator.classList.remove('opacity-0');
                if (isMinimized) { indicator.classList.replace('bg-blue-400', 'bg-gray-400'); indicator.style.width = '6px'; } 
                else { indicator.classList.replace('bg-gray-400', 'bg-blue-400'); indicator.style.width = '16px'; }
            } else {
                indicator.classList.add('opacity-0');
                indicator.style.width = '4px';
            }
        }

        let isDragging = false;
        let isResizing = false;
        let dragTarget = null;
        let dragOffset = { x: 0, y: 0 };

        function startDrag(e, id) {
            if (e.target.closest('.hover\\:bg-red-500') || e.target.closest('.hover\\:bg-gray-200')) return;
            const win = windows.find(w => w.id === id);
            if (win && !win.maximized) {
                isDragging = true;
                dragTarget = win.el;
                bringToFront(id);
                dragOffset.x = e.clientX - win.el.offsetLeft;
                dragOffset.y = e.clientY - win.el.offsetTop;
            }
        }

        function startResize(e, id) {
            const win = windows.find(w => w.id === id);
            if(win && !win.maximized) { isResizing = true; dragTarget = win.el; e.stopPropagation(); }
        }

        document.addEventListener('mousemove', (e) => {
            if (isDragging && dragTarget) {
                let newTop = e.clientY - dragOffset.y;
                let newLeft = e.clientX - dragOffset.x;
                if (newTop < 0) newTop = 0;
                dragTarget.style.top = newTop + 'px';
                dragTarget.style.left = newLeft + 'px';
            }
            if(isResizing && dragTarget) {
                dragTarget.style.width = (e.clientX - dragTarget.getBoundingClientRect().left) + 'px';
                dragTarget.style.height = (e.clientY - dragTarget.getBoundingClientRect().top) + 'px';
            }
        });

        document.addEventListener('mouseup', () => { isDragging = false; isResizing = false; dragTarget = null; });

        // --- SETTINGS CONTENT SWAPPER ---
        function switchSettingsTab(tab) {
            const content = document.getElementById('settings-content');
            const tabs = document.querySelectorAll('.settings-tab');
            tabs.forEach(t => t.classList.remove('bg-gray-200', 'dark:bg-gray-700'));
            document.getElementById('tab-'+tab).classList.add('bg-gray-200', 'dark:bg-gray-700');

            if (tab === 'personalization') {
                content.innerHTML = `
                    <h2 class="text-3xl font-light mb-8">Personalization</h2>
                    <div class="mb-8">
                        <h3 class="font-medium mb-4 text-sm text-gray-500 uppercase tracking-wider">Desktop Background</h3>
                        <div class="flex gap-4">
                            <div onclick="setWallpaper('bg-space')" class="w-32 h-20 bg-space bg-cover rounded-lg cursor-pointer ring-2 ring-transparent hover:ring-blue-500 shadow-sm transition hover:scale-105" title="Space"></div>
                            <div onclick="setWallpaper('bg-midnight')" class="w-32 h-20 bg-midnight bg-cover rounded-lg cursor-pointer ring-2 ring-transparent hover:ring-blue-500 shadow-sm transition hover:scale-105" title="Midnight"></div>
                            <div onclick="setWallpaper('bg-bloom')" class="w-32 h-20 bg-bloom bg-cover rounded-lg cursor-pointer ring-2 ring-transparent hover:ring-blue-500 shadow-sm transition hover:scale-105" title="Bloom"></div>
                            <div onclick="setWallpaper('bg-mountain')" class="w-32 h-20 bg-mountain bg-cover rounded-lg cursor-pointer ring-2 ring-transparent hover:ring-blue-500 shadow-sm transition hover:scale-105" title="Mountain"></div>
                            <div onclick="setWallpaper('bg-abstract')" class="w-32 h-20 bg-abstract bg-cover rounded-lg cursor-pointer ring-2 ring-transparent hover:ring-blue-500 shadow-sm transition hover:scale-105" title="Abstract"></div>
                        </div>
                    </div>
                    <div>
                        <h3 class="font-medium mb-4 text-sm text-gray-500 uppercase tracking-wider">Theme</h3>
                        <div class="bg-white dark:bg-[#1a1a1a] p-6 rounded-xl shadow-sm border border-gray-200 dark:border-gray-800 flex justify-between items-center">
                            <div>
                                <h3 class="font-bold mb-1">Dark Mode</h3>
                                <p class="text-xs text-gray-500">Toggle system-wide dark appearance.</p>
                            </div>
                            <button id="dm-toggle-btn" onclick="toggleDarkMode()" class="bg-blue-600 text-white px-6 py-2 rounded-full hover:bg-blue-700 transition text-sm font-bold shadow-md shadow-blue-500/30">Switch Mode</button>
                        </div>
                    </div>`;
            } else if (tab === 'system') {
                content.innerHTML = `
                    <h2 class="text-3xl font-light mb-8">System</h2>
                    <div class="space-y-4">
                        <div class="bg-white dark:bg-[#1a1a1a] p-6 rounded-xl shadow-sm border border-gray-200 dark:border-gray-800">
                            <h3 class="font-bold mb-1">Display Resolution</h3>
                            <p class="text-xs text-gray-500">1920 x 1080 (Recommended)</p>
                        </div>
                        <div class="bg-white dark:bg-[#1a1a1a] p-6 rounded-xl shadow-sm border border-gray-200 dark:border-gray-800">
                            <h3 class="font-bold mb-1">About</h3>
                            <p class="text-xs text-gray-500">Portfolio OS 11. Version 22H2.</p>
                        </div>
                    </div>`;
            } else if (tab === 'sound') {
                content.innerHTML = `
                    <h2 class="text-3xl font-light mb-8">Sound</h2>
                    <div class="bg-white dark:bg-[#1a1a1a] p-6 rounded-xl shadow-sm border border-gray-200 dark:border-gray-800">
                        <h3 class="font-bold mb-4">Output</h3>
                        <div class="flex items-center gap-4">
                            <i class="fas fa-volume-up text-2xl text-gray-500"></i>
                            <input type="range" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                        </div>
                    </div>`;
            }
        }

        function sendEmail() {
            const sender = document.getElementById('email-sender').value || 'Anonymous';
            const subject = document.getElementById('email-subject').value || 'Project Inquiry';
            const body = document.getElementById('email-body').value || '';
            
            const btn = document.querySelector('button[onclick="sendEmail()"]');
            const originalText = btn.innerHTML;
            
            // Construct the message body
            const fullBody = `From: ${sender}\n\n${body}`;
            const clipboardText = `To: harshalpatel0210@gmail.com\nSubject: ${subject}\n\n${fullBody}`;

            // 1. Try Copying to Clipboard (Fallback method for iframe restrictions)
            try {
                // Create temporary element
                const textArea = document.createElement("textarea");
                textArea.value = clipboardText;
                
                // Avoid scrolling to bottom
                textArea.style.top = "0";
                textArea.style.left = "0";
                textArea.style.position = "fixed";
                
                document.body.appendChild(textArea);
                textArea.focus();
                textArea.select();
                
                const successful = document.execCommand('copy');
                document.body.removeChild(textArea);
                
                if(successful) {
                     btn.innerHTML = '<i class="fas fa-check mr-2"></i> Copied to Clipboard!';
                } else {
                     throw new Error('execCommand failed');
                }
            } catch (err) {
                console.error('Clipboard failed', err);
                btn.innerHTML = '<i class="fas fa-paper-plane mr-2"></i> Sending...';
            }

            // 2. Open Gmail Compose Window (Web-based, more reliable than mailto in sandboxes)
            setTimeout(() => {
                const gmailLink = `https://mail.google.com/mail/?view=cm&fs=1&to=harshalpatel0210@gmail.com&su=${encodeURIComponent(subject)}&body=${encodeURIComponent(fullBody)}`;
                window.open(gmailLink, '_blank');
                
                // Reset button
                setTimeout(() => {
                    btn.innerHTML = originalText;
                }, 3000);
            }, 1000);
        }

        function getAppContent(id) {
            switch (id) {
                case 'settings':
                    setTimeout(() => switchSettingsTab('personalization'), 0);
                    return `
                        <div class="flex h-full bg-[#f3f3f3] dark:bg-[#121212] text-gray-900 dark:text-white">
                            <div class="w-64 bg-white dark:bg-[#1a1a1a] p-4 flex flex-col gap-1 text-sm border-r border-gray-200 dark:border-gray-800">
                                <div class="flex items-center gap-3 p-2 mb-6 bg-gray-100 dark:bg-gray-800 rounded-lg">
                                    <img src="https://ui-avatars.com/api/?name=Harshal+Patel&background=0078d4&color=fff" class="rounded-full w-10 h-10">
                                    <div><div class="font-bold">Harshal Patel</div><div class="text-xs text-gray-500">Local Account</div></div>
                                </div>
                                <div class="font-bold text-gray-500 text-xs px-2 mb-2 uppercase tracking-wider">System</div>
                                <div id="tab-system" onclick="switchSettingsTab('system')" class="settings-tab p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-md cursor-pointer flex items-center gap-3"><i class="fas fa-desktop w-5"></i> Display</div>
                                <div id="tab-sound" onclick="switchSettingsTab('sound')" class="settings-tab p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-md cursor-pointer flex items-center gap-3"><i class="fas fa-volume-up w-5 text-gray-500"></i> Sound</div>
                                <div id="tab-personalization" onclick="switchSettingsTab('personalization')" class="settings-tab p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-md cursor-pointer flex items-center gap-3"><i class="fas fa-paint-brush w-5 text-gray-500"></i> Personalization</div>
                            </div>
                            <div class="flex-1 p-10 overflow-auto" id="settings-content">
                                <!-- Content injected via switchSettingsTab -->
                            </div>
                        </div>`;

                case 'terminal':
                    setTimeout(() => {
                        const input = document.getElementById('term-input');
                        if(input) {
                            input.focus();
                            input.addEventListener('keydown', function(e) {
                                if(e.key === 'Enter') {
                                    const val = this.value.trim().toLowerCase();
                                    const output = document.getElementById('term-output');
                                    output.innerHTML += `<div class="text-gray-400 mb-1 font-bold pt-2">$ ${this.value}</div>`;
                                    
                                    let response = '';
                                    if(val === 'help') response = '<div class="grid grid-cols-2 gap-4 max-w-md text-green-400"><div>show - show the msg</div><div>code - open github</div><div>clear - clear the screen</div><div>google - open browser</div><div>help - list all commands</div><div>resume - open about me</div><div>hack - simulated hack</div><div>popup - show modal</div><div>portfolio - open about me</div><div>projects - open projects</div></div>';
                                    else if(val === 'clear') output.innerHTML = '';
                                    else if(val === 'code') { openApp('github'); response = 'Opening GitHub...'; }
                                    else if(val === 'google') { openApp('browser'); response = 'Opening Browser...'; }
                                    else if(val === 'resume' || val === 'portfolio') { openApp('about'); response = 'Opening About Me...'; }
                                    else if(val === 'projects') { openApp('projects'); response = 'Opening Projects...'; }
                                    else if(val === 'popup') { document.getElementById('custom-modal').classList.remove('hidden'); response = 'Popup opened.'; }
                                    else if(val === 'hack') { 
                                        response = 'Initiating hack sequence...<br>'; 
                                        let hackLines = ['Accessing mainframe...', 'Bypassing firewall...', 'Downloading confidential data...', 'Injecting SQL...', 'Access Granted.'];
                                        hackLines.forEach((line, i) => setTimeout(() => output.innerHTML += `<div class="text-green-500">${line}</div>`, i * 800));
                                    }
                                    else if(val === 'show') response = 'Welcome to Harshal Patel\'s Terminal.';
                                    else if(val === 'secret_command') response = 'You found the secret! ðª';
                                    else if(val !== '') response = `<span class="text-red-400">Command not found: ${val}</span>`;
                                    
                                    if(response) output.innerHTML += `<div class="mb-2 text-gray-300 leading-relaxed">${response}</div>`;
                                    this.value = '';
                                    document.getElementById('term-container').scrollTop = document.getElementById('term-container').scrollHeight;
                                }
                            });
                        }
                    }, 100);
                    return `
                        <div class="h-full bg-black text-white font-mono p-4 text-sm flex flex-col" onclick="document.getElementById('term-input').focus()">
                            <div class="flex-1 overflow-auto" id="term-container">
                                <pre class="text-[#00ff00] font-bold leading-tight mb-6 text-[10px] sm:text-xs md:text-sm whitespace-pre overflow-x-hidden">
  _    _               _           _   _____      _       _ 
 | |  | |             | |         | | |  __ \\    | |     | |
 | |__| | __ _ _ __ __| |__   __ _| | | |__) |___| |_ ___| |
 |  __  |/ _\` | '__/ __| '_ \\ / _\` | | |  ___/ _\` | __/ _ \\ |
 | |  | | (_| | |  \\__ \\ | | | (_| | | | |  | (_| | ||  __/ |
 |_|  |_|\\__,_|_|  |___/_| |_|\\__,_|_| |_|   \\__,_|\\__\\___|_|
                                </pre>
                                <div class="text-[#fcd34d] mb-4 font-bold">ð (hello) ð GLAD TO MEET YOU STRANGER ð <(code)></div>
                                <div class="text-green-400 mb-4">TYPE "HELP" FOR FULL LIST OF COMMANDS</div>
                                <div id="term-output"></div>
                                <div class="flex items-center">
                                    <span class="text-green-500 mr-2 font-bold">></span>
                                    <input id="term-input" type="text" class="bg-transparent outline-none flex-1 text-green-400 font-bold" autocomplete="off" autofocus>
                                </div>
                            </div>
                        </div>
                    `;

                case 'about':
                    return `
                        <div class="flex h-full">
                            <div class="w-1/3 bg-gray-100 dark:bg-[#1a1a1a] p-8 flex flex-col items-center text-center border-r border-gray-200 dark:border-gray-700">
                                <div class="w-32 h-32 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 p-1 mb-4 shadow-lg">
                                    <img src="https://ui-avatars.com/api/?name=Harshal+Patel&background=111&color=fff" class="w-full h-full rounded-full border-4 border-white dark:border-gray-800">
                                </div>
                                <h1 class="text-2xl font-bold text-gray-900 dark:text-white">Harshal Patel</h1>
                                <p class="text-blue-500 font-medium mb-6">Full Stack Developer</p>
                                
                                <div class="flex gap-3 mb-8">
                                    <div class="w-10 h-10 rounded-full bg-white dark:bg-gray-800 flex items-center justify-center shadow-sm hover:text-blue-500 transition cursor-pointer" onclick="openApp('github')"><i class="fab fa-github text-xl"></i></div>
                                    <div class="w-10 h-10 rounded-full bg-white dark:bg-gray-800 flex items-center justify-center shadow-sm hover:text-blue-700 transition cursor-pointer" onclick="window.open('https://www.linkedin.com/in/harshal-patel-2547har', '_blank')"><i class="fab fa-linkedin text-xl"></i></div>
                                    <div class="w-10 h-10 rounded-full bg-white dark:bg-gray-800 flex items-center justify-center shadow-sm hover:text-red-500 transition cursor-pointer" onclick="openApp('contact')"><i class="fas fa-envelope text-xl"></i></div>
                                </div>

                                <button onclick="openApp('contact')" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-2 rounded-lg font-medium transition shadow-md">Contact Me</button>
                            </div>
                            <div class="flex-1 p-10 overflow-auto bg-white dark:bg-[#121212] text-gray-800 dark:text-gray-300">
                                <h2 class="text-3xl font-bold mb-6 text-gray-900 dark:text-white">Hello, I'm Harshal! ð</h2>
                                <p class="text-lg leading-relaxed mb-6">I'm @Harshal-Patel-In, a passionate software engineer interested in AI and currently learning Computer Science. This portfolio is actually a functional web app built with <span class="text-orange-500 font-bold">HTML</span>, <span class="text-blue-500 font-bold">CSS</span> & <span class="text-yellow-500 font-bold">JavaScript</span>.</p>
                                <p class="text-lg leading-relaxed mb-8">I specialize in creating high-performance frontends and robust backends. When I'm not coding, I'm also interested in Photography and Drawing.</p>
                                
                                <h3 class="text-xl font-bold mb-4 border-b dark:border-gray-700 pb-2">What I Do</h3>
                                <div class="grid grid-cols-2 gap-4">
                                    <div class="p-4 bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-100 dark:border-gray-700">
                                        <i class="fas fa-code text-blue-500 mb-2 text-xl"></i>
                                        <h4 class="font-bold text-gray-900 dark:text-white">Web Development</h4>
                                        <p class="text-sm text-gray-500">HTML, CSS, JS</p>
                                    </div>
                                    <div class="p-4 bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-100 dark:border-gray-700">
                                        <i class="fas fa-brain text-green-500 mb-2 text-xl"></i>
                                        <h4 class="font-bold text-gray-900 dark:text-white">Data Science & AI</h4>
                                        <p class="text-sm text-gray-500">Python, Pandas, Sklearn</p>
                                    </div>
                                </div>

                                <h3 class="text-xl font-bold mb-4 mt-8 border-b dark:border-gray-700 pb-2">Tech Stack</h3>
                                <div class="grid grid-cols-4 gap-4">
                                    <img src="https://cdn.jsdelivr.net/gh/devicons/devicon/icons/html5/html5-original.svg" class="w-12 h-12" title="HTML5">
                                    <img src="https://cdn.jsdelivr.net/gh/devicons/devicon/icons/css3/css3-original.svg" class="w-12 h-12" title="CSS3">
                                    <img src="https://cdn.jsdelivr.net/gh/devicons/devicon/icons/javascript/javascript-original.svg" class="w-12 h-12" title="JavaScript">
                                    <img src="https://cdn.jsdelivr.net/gh/devicons/devicon/icons/python/python-original.svg" class="w-12 h-12" title="Python">
                                    <img src="https://cdn.jsdelivr.net/gh/devicons/devicon/icons/java/java-original.svg" class="w-12 h-12" title="Java">
                                    <img src="https://cdn.jsdelivr.net/gh/devicons/devicon/icons/pandas/pandas-original.svg" class="w-12 h-12" title="Pandas">
                                    <img src="https://cdn.jsdelivr.net/gh/devicons/devicon/icons/numpy/numpy-original.svg" class="w-12 h-12" title="NumPy">
                                    <img src="https://upload.wikimedia.org/wikipedia/commons/0/05/Scikit_learn_logo_small.svg" class="w-12 h-12" title="Scikit-learn">
                                </div>
                            </div>
                        </div>`;
                
                case 'stack':
                     const techLogos = [
                        { n: 'HTML', i: 'https://cdn.jsdelivr.net/gh/devicons/devicon/icons/html5/html5-original.svg' },
                        { n: 'CSS', i: 'https://cdn.jsdelivr.net/gh/devicons/devicon/icons/css3/css3-original.svg' },
                        { n: 'JavaScript', i: 'https://cdn.jsdelivr.net/gh/devicons/devicon/icons/javascript/javascript-original.svg' },
                        { n: 'Python', i: 'https://cdn.jsdelivr.net/gh/devicons/devicon/icons/python/python-original.svg' },
                        { n: 'Java', i: 'https://cdn.jsdelivr.net/gh/devicons/devicon/icons/java/java-original.svg' },
                        { n: 'Pandas', i: 'https://cdn.jsdelivr.net/gh/devicons/devicon/icons/pandas/pandas-original.svg' },
                        { n: 'NumPy', i: 'https://cdn.jsdelivr.net/gh/devicons/devicon/icons/numpy/numpy-original.svg' },
                        { n: 'Sklearn', i: 'https://upload.wikimedia.org/wikipedia/commons/0/05/Scikit_learn_logo_small.svg' },
                        { n: 'Matplotlib', i: 'https://upload.wikimedia.org/wikipedia/commons/8/84/Matplotlib_icon.svg' }, 
                        { n: 'Seaborn', i: 'https://seaborn.pydata.org/_images/logo-mark-lightbg.svg' }
                    ];
                    let grid = '';
                    techLogos.forEach(t => { 
                        grid += `
                        <div class="flex flex-col items-center justify-center p-6 rounded-xl bg-white dark:bg-gray-800 shadow-sm border border-gray-100 dark:border-gray-700 hover:shadow-md transition cursor-default group">
                            <img src="${t.i}" class="w-16 h-16 mb-4 transition group-hover:scale-110">
                            <span class="font-bold text-gray-700 dark:text-gray-200">${t.n}</span>
                        </div>`; 
                    });
                    return `<div class="p-8 h-full bg-gray-50 dark:bg-[#121212] overflow-auto"><h2 class="text-3xl font-bold mb-2 dark:text-white">Tech Stack</h2><p class="text-gray-500 mb-8">Tools and technologies I use to bring products to life.</p><div class="grid grid-cols-4 gap-6">${grid}</div></div>`;

                case 'projects':
                    return `<div class="flex h-full bg-gray-100 dark:bg-[#121212]"><div class="w-64 bg-white dark:bg-[#1a1a1a] border-r border-gray-200 dark:border-gray-700 flex flex-col"><div class="p-4 font-bold text-lg border-b dark:border-gray-700 dark:text-white">Categories</div><div class="p-2 space-y-1"><div class="px-4 py-2 bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400 rounded-md font-medium cursor-pointer">All Projects</div><div class="px-4 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md cursor-pointer">Web Apps</div></div></div><div class="flex-1 p-8 overflow-auto"><div class="grid grid-cols-1 lg:grid-cols-2 gap-6"><div class="project-card bg-white dark:bg-[#1e1e1e] rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden transition"><div class="h-48 bg-gray-200 dark:bg-gray-700 relative group"><div class="absolute inset-0 flex items-center justify-center text-gray-400 text-4xl group-hover:scale-110 transition"><i class="fas fa-shopping-bag"></i></div></div><div class="p-6"><h3 class="text-xl font-bold mb-2 dark:text-white">E-Commerce Dashboard</h3><p class="text-gray-500 text-sm mb-4">Admin dashboard with real-time analytics.</p></div></div></div></div></div>`;

                case 'contact':
                    return `
                    <div class="flex flex-col h-full bg-white dark:bg-[#121212]">
                        <div class="bg-gray-50 dark:bg-[#1a1a1a] p-3 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center">
                            <div class="flex gap-2">
                                <button onclick="sendEmail()" class="px-4 py-1.5 bg-blue-600 text-white rounded-md text-sm font-medium hover:bg-blue-700 transition shadow-sm flex items-center">
                                    <i class="fas fa-paper-plane mr-2"></i> Send
                                </button>
                            </div>
                        </div>
                        <div class="p-6 flex-1 overflow-auto max-w-3xl mx-auto w-full">
                            <div class="space-y-4">
                                <div class="flex items-center border-b border-gray-100 dark:border-gray-800 pb-2">
                                    <span class="text-gray-500 w-16 text-sm">To:</span>
                                    <span class="bg-gray-100 dark:bg-gray-800 px-2 py-1 rounded text-sm text-gray-800 dark:text-gray-200 font-mono">harshalpatel0210@gmail.com</span>
                                </div>
                                <div class="flex items-center border-b border-gray-100 dark:border-gray-800 pb-2">
                                    <span class="text-gray-500 w-16 text-sm">From:</span>
                                    <input id="email-sender" type="email" placeholder="your.email@example.com" class="flex-1 bg-transparent outline-none text-gray-800 dark:text-white text-sm font-medium">
                                </div>
                                <div class="flex items-center border-b border-gray-100 dark:border-gray-800 pb-2">
                                    <span class="text-gray-500 w-16 text-sm">Subject:</span>
                                    <input id="email-subject" type="text" placeholder="Project Inquiry" class="flex-1 bg-transparent outline-none text-gray-800 dark:text-white text-sm font-medium">
                                </div>
                                <textarea id="email-body" class="w-full h-64 bg-transparent outline-none text-gray-800 dark:text-gray-300 resize-none mt-4 leading-relaxed p-2" placeholder="Hi Harshal..."></textarea>
                            </div>
                        </div>
                    </div>`;

                case 'calc':
                    return `<div class="flex flex-col h-full bg-[#f3f3f3] dark:bg-gray-800"><div class="h-24 flex flex-col items-end justify-end p-4 text-4xl font-semibold select-all dark:text-white break-all" id="calc-display">0</div><div class="flex-1 grid grid-cols-4 gap-1 p-1"><button class="bg-white dark:bg-gray-700 hover:bg-gray-100 p-2 rounded text-sm" onclick="calcInput('C')">C</button><button class="bg-white dark:bg-gray-700 hover:bg-gray-100 p-2 rounded text-sm" onclick="calcInput('(')">(</button><button class="bg-white dark:bg-gray-700 hover:bg-gray-100 p-2 rounded text-sm" onclick="calcInput(')')">)</button><button class="bg-orange-100 text-orange-600 hover:bg-orange-200 p-2 rounded text-sm" onclick="calcInput('/')">Ã·</button><button class="bg-white dark:bg-gray-600 hover:bg-gray-100 p-2 rounded font-bold" onclick="calcInput('7')">7</button><button class="bg-white dark:bg-gray-600 hover:bg-gray-100 p-2 rounded font-bold" onclick="calcInput('8')">8</button><button class="bg-white dark:bg-gray-600 hover:bg-gray-100 p-2 rounded font-bold" onclick="calcInput('9')">9</button><button class="bg-orange-100 text-orange-600 hover:bg-orange-200 p-2 rounded text-sm" onclick="calcInput('*')">Ã</button><button class="bg-white dark:bg-gray-600 hover:bg-gray-100 p-2 rounded font-bold" onclick="calcInput('4')">4</button><button class="bg-white dark:bg-gray-600 hover:bg-gray-100 p-2 rounded font-bold" onclick="calcInput('5')">5</button><button class="bg-white dark:bg-gray-600 hover:bg-gray-100 p-2 rounded font-bold" onclick="calcInput('6')">6</button><button class="bg-orange-100 text-orange-600 hover:bg-orange-200 p-2 rounded text-sm" onclick="calcInput('-')">-</button><button class="bg-white dark:bg-gray-600 hover:bg-gray-100 p-2 rounded font-bold" onclick="calcInput('1')">1</button><button class="bg-white dark:bg-gray-600 hover:bg-gray-100 p-2 rounded font-bold" onclick="calcInput('2')">2</button><button class="bg-white dark:bg-gray-600 hover:bg-gray-100 p-2 rounded font-bold" onclick="calcInput('3')">3</button><button class="bg-orange-100 text-orange-600 hover:bg-orange-200 p-2 rounded text-sm" onclick="calcInput('+')">+</button><button class="bg-white dark:bg-gray-600 hover:bg-gray-100 p-2 rounded font-bold col-span-2" onclick="calcInput('0')">0</button><button class="bg-white dark:bg-gray-600 hover:bg-gray-100 p-2 rounded font-bold" onclick="calcInput('.')">.</button><button class="bg-blue-600 text-white hover:bg-blue-700 p-2 rounded font-bold" onclick="calcInput('=')">=</button></div></div>`;

                case 'browser':
                    return `<div class="flex flex-col h-full bg-white dark:bg-[#121212]"><div class="bg-gray-100 dark:bg-[#1a1a1a] p-2 flex items-center gap-2 border-b border-gray-200 dark:border-gray-700"><div class="flex gap-1 mr-2"><i class="fas fa-arrow-left text-gray-500 p-2 hover:bg-gray-200 dark:hover:bg-white/10 rounded-full cursor-pointer w-8 h-8 flex items-center justify-center" onclick="window.frames['edge-frame'].history.back()"></i><i class="fas fa-arrow-right text-gray-500 p-2 hover:bg-gray-200 dark:hover:bg-white/10 rounded-full cursor-pointer w-8 h-8 flex items-center justify-center" onclick="window.frames['edge-frame'].history.forward()"></i><i class="fas fa-rotate-right text-gray-500 p-2 hover:bg-gray-200 dark:hover:bg-white/10 rounded-full cursor-pointer w-8 h-8 flex items-center justify-center" onclick="edgeNavigate()"></i></div><form onsubmit="event.preventDefault(); edgeNavigate();" class="flex-1 flex gap-2"><input type="text" id="edge-url" value="https://www.wikipedia.org" class="flex-1 bg-white dark:bg-[#0d1117] rounded-full px-4 py-1.5 text-sm border border-gray-300 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500/50 text-gray-600 dark:text-gray-300 shadow-sm"></form></div><iframe id="edge-frame" name="edge-frame" src="https://www.wikipedia.org" class="flex-1 w-full h-full border-0 bg-white"></iframe></div>`;

                case 'github':
                    // Helper for creating repo cards with proper styling and onClick handler
                    const generateRepoCard = (title, desc, lang, stars, color, url) => `
                        <div onclick="window.open('${url}', '_blank')" class="border border-[#30363d] rounded-md p-4 bg-[#0d1117] flex flex-col justify-between h-28 hover:border-[#8b949e] cursor-pointer transition-colors">
                            <div>
                                <div class="flex justify-between items-start">
                                    <span class="font-bold text-[#58a6ff] hover:underline text-sm mb-2 block truncate">${title}</span>
                                    <span class="text-xs border border-[#30363d] text-[#8b949e] px-2 rounded-full">Public</span>
                                </div>
                                ${desc ? `<p class="text-xs text-[#8b949e] line-clamp-2 mb-4">${desc}</p>` : ''}
                            </div>
                            <div class="flex items-center gap-4 text-xs text-[#8b949e] mt-auto">
                                ${lang ? `<span class="flex items-center gap-1"><span class="w-3 h-3 rounded-full" style="background-color: ${color}"></span> ${lang}</span>` : ''}
                                ${stars ? `<span class="flex items-center gap-1 hover:text-[#58a6ff]"><i class="far fa-star"></i> ${stars}</span>` : ''}
                            </div>
                        </div>
                    `;

                    return `
                    <div class="flex flex-col h-full bg-[#0d1117] text-[#c9d1d9] font-sans overflow-hidden">
                        <!-- Header -->
                        <div class="bg-[#161b22] border-b border-[#30363d] p-4 flex items-center gap-4">
                            <i class="fas fa-bars text-[#c9d1d9] text-lg"></i>
                            <i class="fab fa-github text-white text-2xl"></i>
                            <span class="font-bold text-sm">Harshal-Patel-In</span>
                            <div class="flex-1"></div>
                            <div class="relative w-64 hidden md:block">
                                <div class="absolute inset-y-0 left-0 flex items-center pl-2 pointer-events-none"><i class="fas fa-search text-[#8b949e] text-xs"></i></div>
                                <input type="text" placeholder="Type / to search" class="w-full bg-[#0d1117] border border-[#30363d] rounded-md py-1 pl-8 text-sm text-white focus:border-blue-500 focus:ring-1 focus:ring-blue-500 focus:outline-none h-7">
                            </div>
                            <div class="flex gap-3 text-[#c9d1d9] items-center border-l border-[#30363d] pl-4">
                                <i class="fas fa-plus cursor-pointer hover:text-white"></i>
                                <i class="far fa-dot-circle cursor-pointer hover:text-white"></i>
                                <i class="fas fa-code-pull-request cursor-pointer hover:text-white"></i>
                                <i class="far fa-bell cursor-pointer hover:text-white"></i>
                                <img src="https://ui-avatars.com/api/?name=Harshal+Patel&background=random" class="w-5 h-5 rounded-full border border-[#30363d]">
                            </div>
                        </div>

                        <!-- Navigation Tabs -->
                        <div class="bg-[#0d1117] border-b border-[#30363d] px-8 flex gap-6 text-sm sticky top-0 z-10 pt-4 overflow-x-auto">
                            <div class="flex items-center gap-2 border-b-2 border-[#f78166] pb-2 px-1 font-semibold cursor-pointer"><i class="fas fa-book-open"></i> Overview</div>
                            <div class="flex items-center gap-2 pb-2 px-1 text-[#8b949e] hover:text-[#c9d1d9] cursor-pointer"><i class="fas fa-book"></i> Repositories <span class="bg-[#30363d] text-[#c9d1d9] rounded-full px-2 text-xs">11</span></div>
                            <div class="flex items-center gap-2 pb-2 px-1 text-[#8b949e] hover:text-[#c9d1d9] cursor-pointer"><i class="fas fa-table-columns"></i> Projects</div>
                            <div class="flex items-center gap-2 pb-2 px-1 text-[#8b949e] hover:text-[#c9d1d9] cursor-pointer"><i class="fas fa-box"></i> Packages</div>
                            <div class="flex items-center gap-2 pb-2 px-1 text-[#8b949e] hover:text-[#c9d1d9] cursor-pointer"><i class="far fa-star"></i> Stars <span class="bg-[#30363d] text-[#c9d1d9] rounded-full px-2 text-xs">1</span></div>
                        </div>

                        <!-- Main Content -->
                        <div class="flex-1 overflow-y-auto flex flex-col md:flex-row max-w-7xl mx-auto w-full">
                            <!-- Sidebar -->
                            <div class="w-full md:w-80 p-4 md:p-8 md:-mt-8 z-20">
                                <div class="relative group w-full aspect-square max-w-[296px] rounded-full overflow-hidden border border-[#30363d] mb-4">
                                    <img src="https://ui-avatars.com/api/?name=Harshal+Patel&background=random&size=300" class="w-full h-full object-cover bg-[#0d1117]">
                                    <div class="absolute bottom-8 left-0 right-0 flex items-center justify-center bg-white/10 backdrop-blur-sm rounded-full w-8 h-8 mx-auto border border-[#30363d] cursor-pointer hover:text-blue-400"><i class="far fa-smile"></i></div>
                                </div>
                                
                                <h1 class="text-2xl font-bold text-[#c9d1d9]">Harshal Patel</h1>
                                <div class="text-[#8b949e] text-xl mb-4">Harshal-Patel-In â¢ he/him</div>
                                
                                <button class="w-full bg-[#21262d] border border-[#30363d] rounded-md py-1.5 text-sm font-medium text-[#c9d1d9] hover:bg-[#30363d] hover:border-[#8b949e] transition mb-4">Edit profile</button>
                                
                                <div class="flex items-center gap-1 text-[#8b949e] text-sm mb-6">
                                    <i class="fas fa-user-group text-[#8b949e]"></i>
                                    <span class="font-bold text-[#c9d1d9] hover:text-[#58a6ff] cursor-pointer">2</span> followers
                                    <span>Â·</span>
                                    <span class="font-bold text-[#c9d1d9] hover:text-[#58a6ff] cursor-pointer">3</span> following
                                </div>

                                <div class="space-y-2 text-sm text-[#c9d1d9]">
                                    <div class="flex items-center gap-2"><i class="far fa-clock text-[#8b949e] w-4 text-center"></i> 13:13 (UTC +05:30)</div>
                                    <div class="flex items-center gap-2"><i class="far fa-envelope text-[#8b949e] w-4 text-center"></i> <a href="mailto:harshalpatel0210@gmail.com" class="hover:text-[#58a6ff] hover:underline">harshalpatel0210@gmail.com</a></div>
                                </div>

                                <div class="mt-6 pt-6 border-t border-[#30363d]">
                                    <h2 class="font-bold mb-2">Achievements</h2>
                                    <div class="flex gap-2">
                                        <img src="https://github.githubassets.com/assets/quickdraw-default--light-8f798b35341a.png" class="w-16 h-16" title="Quickdraw">
                                    </div>
                                </div>
                            </div>

                            <!-- Right Column -->
                            <div class="flex-1 p-4 md:p-8">
                                <!-- Readme Section -->
                                <div class="border border-[#30363d] rounded-md p-6 mb-8">
                                    <div class="text-xs text-[#8b949e] mb-4 flex justify-between items-center">
                                        <span>Harshal-Patel-In / README.md</span>
                                        <i class="fas fa-pencil text-[#8b949e] hover:text-[#58a6ff] cursor-pointer"></i>
                                    </div>
                                    <div class="prose prose-invert max-w-none text-sm">
                                        <h3 class="text-lg font-bold mb-2">Hi, I'm @Harshal-Patel-In</h3>
                                        <ul class="list-none space-y-1 pl-0">
                                            <li>ð Hi, I'm @Harshal-Patel-In</li>
                                            <li>ð I'm interested in AI</li>
                                            <li>ð± I'm currently learning Computer Science</li>
                                            <li>ðï¸ I'm looking to collaborate on AI-ML projects</li>
                                            <li>ð« How to reach me <a href="#" class="text-[#58a6ff] hover:underline">harshalpatel0210@gmail.com</a></li>
                                            <li>ð Pronouns: Any Name You Like ð</li>
                                            <li>â¡ Fun fact: I am also interested in Photography and Drawing.</li>
                                        </ul>
                                    </div>
                                </div>

                                <!-- Popular Repos -->
                                <div class="flex justify-between items-end mb-2">
                                    <h2 class="text-base font-normal">Popular repositories</h2>
                                    <span class="text-xs text-[#58a6ff] hover:underline cursor-pointer">Customize your pins</span>
                                </div>
                                
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    ${generateRepoCard('Graphy', 'This Is Graph Visualizer And QnA Bot App', 'Python', '1', '#3572A5', 'https://github.com/Harshal-Patel-In/Graphy')}
                                    ${generateRepoCard('Harshal-Patel-In', 'Config files for my GitHub profile.', null, null, null, 'https://github.com/Harshal-Patel-In/Harshal-Patel-In')}
                                    ${generateRepoCard('GeoH2', 'Forked from ClimateCompatibleGrowth/GeoH2... Geospatial analysis...', 'Python', '', '#3572A5', 'https://github.com/Harshal-Patel-In/GeoH2')}
                                    ${generateRepoCard('urban-h2-navigator', null, 'TypeScript', '2', '#2b7489', 'https://github.com/Harshal-Patel-In/urban-h2-navigator')}
                                    ${generateRepoCard('guvnl-feedback-app', 'Forked from kunj-31/guvnl-feedback-app', null, null, null, 'https://github.com/Harshal-Patel-In/guvnl-feedback-app')}
                                    ${generateRepoCard('SSIP', null, null, null, null, 'https://github.com/Harshal-Patel-In/SSIP')}
                                </div>
                            </div>
                        </div>
                    </div>
                    `;

                default:
                    return `<div class="p-4">App not found</div>`;
            }
        }

        function edgeNavigate() {
            const urlInput = document.getElementById('edge-url');
            const frame = document.getElementById('edge-frame');
            if (!urlInput || !frame) return;
            let url = urlInput.value;
            if (!url.startsWith('http')) url = 'https://' + url;
            frame.src = url;
            urlInput.value = url;
        }

        let calcExp = '';
        function calcInput(val) {
            const display = document.getElementById('calc-display');
            if (val === 'C') {
                calcExp = '';
                display.innerText = '0';
            } else if (val === '=') {
                try {
                    const safeExp = calcExp.replace(/Ã/g, '*').replace(/Ã·/g, '/');
                    const result = eval(safeExp); 
                    display.innerText = result;
                    calcExp = String(result);
                } catch {
                    display.innerText = 'Error';
                    calcExp = '';
                }
            } else {
                if (display.innerText === '0' && !isNaN(val)) calcExp = '';
                calcExp += val;
                display.innerText = calcExp;
            }
        }
    </script>
</body>
</html>